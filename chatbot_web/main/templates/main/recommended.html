{% extends 'main/base.html' %}
{% block content %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¶”ì²œ ì—¬í–‰ì§€ ì…ë ¥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Flatpickr (ë‹¬ë ¥) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="p-4">
  <div class="container">
    <h2 class="mb-4 text-center">ì¶”ì²œ ì—¬í–‰ì§€ ì„ íƒ</h2>

    <!-- ğŸ“… ì—¬í–‰ ë‚ ì§œ ì„ íƒ -->
    <div class="mb-3">
      <label for="travel-dates" class="form-label">ì—¬í–‰ ê¸°ê°„</label>
      <input type="text" id="travel-dates" class="form-control" placeholder="ì‹œì‘ì¼ ~ ì¢…ë£Œì¼ ì„ íƒ">
    </div>

    <!-- ğŸ“ ì§€ì—­ ì„ íƒ -->
    <div class="mb-3">
      <label class="form-label">ì—¬í–‰ ì§€ì—­</label>
      <div class="row g-2">
        <div class="col-md-6">
          <select id="region" class="form-select">
            <option value="">-- ì‹œ/ë„ ì„ íƒ --</option>
          </select>
        </div>
        <div class="col-md-6">
          <select id="sub-region" class="form-select" disabled>
            <option value="">-- ì„¸ë¶€ ì§€ì—­ ì„ íƒ --</option>
          </select>
        </div>
      </div>
    </div>

    <!-- ğŸ‘¥ ì¸ì› ìˆ˜ -->
    <div class="mb-3 row">
      <div class="col-md-6">
        <label for="adults" class="form-label">ì„±ì¸ ìˆ˜</label>
        <input type="number" id="adults" class="form-control" min="1" value="1">
      </div>
      <div class="col-md-6">
        <label for="children" class="form-label">ì–´ë¦°ì´ ìˆ˜</label>
        <input type="number" id="children" class="form-control" min="0" value="0">
      </div>
    </div>

    <!-- âœ… ì¶”ì²œ ë²„íŠ¼ -->
    <div class="text-center">
      <button class="btn btn-primary">ì¶”ì²œ ë°›ê¸°</button>
    </div>
  </div>

  <!-- âœ… ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    const TOUR_API_KEY = "{{ TOUR_API_KEY|urlencode }}";
    const regionSelect = document.getElementById("region");
    const subRegionSelect = document.getElementById("sub-region");

    // ğŸ“… ë‹¬ë ¥ ì´ˆê¸°í™”
    flatpickr("#travel-dates", {
      mode: "range",
      dateFormat: "Y-m-d",
      locale: "ko",
      minDate: "today"
    });

    // âœ… ì‹œ/ë„ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadProvinces() {
      const url = `https://apis.data.go.kr/B551011/KorService2/areaCode2?serviceKey=${TOUR_API_KEY}&MobileOS=ETC&MobileApp=MyApp&_type=json&numOfRows=100`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        const items = data.response.body.items.item;

        regionSelect.innerHTML = `<option value="">-- ì‹œ/ë„ ì„ íƒ --</option>`;
        items.forEach(region => {
          const option = document.createElement("option");
          option.value = region.code;
          option.textContent = region.name;
          regionSelect.appendChild(option);
        });
      } catch (err) {
        console.error("âŒ ì‹œ/ë„ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨", err);
      }
    }

    // âœ… ì„¸ë¶€ ì§€ì—­ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadSubRegions(areaCode) {
      const url = `https://apis.data.go.kr/B551011/KorService2/areaCode2?serviceKey=${TOUR_API_KEY}&areaCode=${areaCode}&MobileOS=ETC&MobileApp=MyApp&_type=json&numOfRows=100`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        const items = data.response.body.items.item;

        subRegionSelect.innerHTML = `<option value="">-- ì„¸ë¶€ ì§€ì—­ ì„ íƒ --</option>`;

        if (Array.isArray(items)) {
          items.forEach(sub => {
            const option = document.createElement("option");
            option.value = sub.code;
            option.textContent = sub.name;
            subRegionSelect.appendChild(option);
          });
        } else if (items) {
          const option = document.createElement("option");
          option.value = items.code;
          option.textContent = items.name;
          subRegionSelect.appendChild(option);
        }

        subRegionSelect.disabled = false;
      } catch (err) {
        console.error("âŒ ì„¸ë¶€ ì§€ì—­ ë¡œë“œ ì‹¤íŒ¨", err);
      }
    }

    // âœ… ì´ë²¤íŠ¸ ì—°ê²°
    regionSelect.addEventListener("change", (e) => {
      const selectedAreaCode = e.target.value;
      if (selectedAreaCode) {
        loadSubRegions(selectedAreaCode);
      } else {
        subRegionSelect.innerHTML = `<option value="">-- ì„¸ë¶€ ì§€ì—­ ì„ íƒ --</option>`;
        subRegionSelect.disabled = true;
      }
    });

    // âœ… í˜ì´ì§€ ë¡œë“œì‹œ ì§€ì—­ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    loadProvinces();
  </script>
</body>
</html>
{% endblock %}
